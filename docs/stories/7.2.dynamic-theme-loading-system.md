# Story 7.2: Dynamic Theme Loading System

## Status
Approved

## Story
**As a** Developer,
**I want** a dynamic CSS loading system for themes,
**so that** theme changes are applied instantly across all components with smooth visual transitions.

## Acceptance Criteria
1. Layout component is modified to support dynamic theme CSS variable injection.
2. Theme-specific CSS variable definitions are created for Ocean, Sunset, and Forest themes.
3. Each theme includes comprehensive color palettes for both light and dark mode variants.
4. CSS transition animations are implemented for smooth theme switching without jarring visual changes.
5. Theme CSS variables properly override Tailwind CSS configuration without conflicts.
6. Theme switching maintains component styling integrity across all existing components.
7. CSS cascade behavior ensures theme variables take precedence over default styling.
8. Performance is optimized to prevent layout shifts during theme transitions.

## Tasks / Subtasks
- [ ] Modify Layout component for theme CSS injection (AC: 1)
  - [ ] Import and integrate ThemeProvider from Story 7.1
  - [ ] Add dynamic CSS class application to document root
  - [ ] Implement theme CSS file loading mechanism
  - [ ] Ensure proper cleanup of previous theme classes
- [ ] Enhance existing theme CSS files (AC: 2, 3)
  - [ ] Verify Ocean theme CSS completeness for light/dark modes
  - [ ] Verify Sunset theme CSS completeness for light/dark modes
  - [ ] Verify Forest theme CSS completeness for light/dark modes
  - [ ] Ensure all shadcn/ui variables are covered in each theme
- [ ] Implement smooth transition animations (AC: 4, 8)
  - [ ] Add CSS transitions for color properties without causing layout shifts
  - [ ] Configure transition durations for optimal user experience
  - [ ] Implement reduced motion support for accessibility
  - [ ] Test performance impact of transitions across devices
- [ ] Ensure Tailwind CSS compatibility (AC: 5, 7)
  - [ ] Verify theme variables take precedence over default Tailwind colors
  - [ ] Test CSS cascade behavior with existing component styling
  - [ ] Ensure no conflicts with custom Tailwind configuration
  - [ ] Validate static export compatibility with dynamic theme loading
- [ ] Validate component styling integrity (AC: 6)
  - [ ] Test all existing UI components with each theme
  - [ ] Verify header and footer styling across themes
  - [ ] Test hero sections and page-specific components
  - [ ] Ensure form components maintain proper styling
- [ ] Add unit tests for dynamic loading system (Testing Requirements)
  - [ ] Test theme CSS class application and removal
  - [ ] Test transition behavior and performance
  - [ ] Test component styling integrity across theme switches
  - [ ] Test reduced motion preference handling

## Dev Notes

### Previous Story Dependencies
[Source: docs/stories/7.1.theme-context-state-management.md]
**Required from Story 7.1:**
- ThemeProvider component with theme state management
- useTheme hook for accessing current theme and switching functions
- Theme context providing type-safe theme options ('ocean', 'sunset', 'forest')
- localStorage persistence and hydration logic

### Tech Stack Requirements
[Source: docs/architecture/3-tech-stack.md]
**MUST use these exact versions:**
- **Framework**: Next.js ~14.2.3 (App Router with static export)
- **UI Library**: React ~18.3.1 (Component architecture)
- **Styling**: Tailwind CSS ~3.4.3 (Utility-first CSS with design system)
- **Language**: TypeScript ~5.4.5 (Type safety throughout)
- **Testing**: Jest / RTL ~29.7.0 (Unit and integration testing)

### Project Structure Requirements
[Source: docs/architecture/5-unified-project-structure.md]
**File locations for this story:**
- `/src/app/layout.tsx` - Root layout with ThemeProvider integration
- `/src/lib/theme-loader.ts` - Dynamic CSS loading utilities
- `/src/styles/themes/` - Existing theme CSS files (Ocean, Sunset, Forest)
- `/src/styles/theme-transitions.css` - Transition animations for theme switching
- `/src/lib/theme-loader.test.ts` - Unit tests for theme loading functionality

**Architecture compliance:**
- Maintain Next.js App Router patterns with dynamic CSS loading
- Use TypeScript for theme loading utilities and type definitions
- Preserve existing project structure while enhancing theme capabilities
- Ensure static export compatibility for Vercel deployment

### Theme CSS Configuration
[Source: src/styles/themes/index.ts and existing CSS files]
**Existing theme structure:**
- **Ocean theme**: `src/styles/themes/ocean.css` - Deep blue ocean tones
- **Sunset theme**: `src/styles/themes/sunset.css` - Warm orange/red colors
- **Forest theme**: `src/styles/themes/forest.css` - Natural green tones

**CSS Variable Structure:**
- Uses HSL space-separated values (e.g., "200 100% 25%")
- Compatible with Tailwind CSS and shadcn/ui components
- Includes comprehensive light and dark mode variants
- Covers all standard shadcn/ui color variables (background, foreground, primary, etc.)

### Dynamic Loading Requirements
**CSS Class Management:**
- Apply theme classes dynamically to `document.documentElement`
- Remove previous theme classes before applying new ones
- Use class naming pattern: `theme-ocean`, `theme-sunset`, `theme-forest`
- Handle both theme switching and light/dark mode switching

**Performance Considerations:**
- Minimize CSS bundle size impact
- Prevent layout shifts during theme transitions
- Optimize for Core Web Vitals (CLS < 0.1)
- Implement efficient CSS loading without blocking rendering

### Tailwind CSS Integration
**Configuration Requirements:**
- Theme CSS variables must override default Tailwind color values
- Ensure proper CSS cascade order for theme precedence
- Maintain compatibility with existing custom Tailwind configuration
- Preserve design system tokens while enabling theme switching

**CSS Cascade Strategy:**
- Theme variables defined in `:root` with higher specificity
- Use CSS custom properties for dynamic color values
- Ensure theme classes take precedence over default styling
- Maintain component-specific styling while enabling theme overrides

### Transition and Animation Requirements
**Smooth Theme Switching:**
- Implement CSS transitions for color properties only (avoid layout properties)
- Use optimal transition duration (150-300ms) for perceived performance
- Include easing functions for natural feel (`ease-in-out`)
- Support `prefers-reduced-motion` for accessibility compliance

**Performance Optimization:**
- Use `transform` and `opacity` for performant animations
- Avoid animating layout-affecting properties
- Implement efficient CSS selector strategies
- Test on lower-end devices for performance validation

### Component Integration Strategy
**Layout Integration:**
- Integrate ThemeProvider at root layout level
- Apply theme classes to document element for global effect
- Ensure theme switching doesn't break existing component functionality
- Maintain component isolation while enabling theme overrides

**Component Testing Strategy:**
- Test all UI components (`/src/components/ui/`) with each theme
- Verify layout components (Header, Footer) maintain styling
- Test page-specific sections with theme variations
- Ensure form components and interactive elements work correctly

### Testing
[Source: docs/architecture/8-testing-strategy.md]
**Testing Standards:**
- **Unit Tests**: Located alongside component files using Jest and React Testing Library
- **Test Coverage**: Dynamic CSS loading, theme switching, and component rendering
- **Integration Tests**: Full theme switching workflow with visual integrity validation

**Required Test Cases:**
- CSS class application and removal on document element
- Theme CSS loading and unloading functionality
- Transition performance and animation behavior
- Component styling integrity across all themes
- Reduced motion preference respect
- Layout stability during theme transitions
- Tailwind CSS compatibility and cascade behavior

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-31 | 1.0 | Initial story creation for Epic 7.2 | Scrum Master Bob |

## Dev Agent Record
*This section will be populated during implementation*

## QA Results
*This section will be populated during QA review*